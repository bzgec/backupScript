= Backup script
:toc:
:sectnums:
:sectnumlevels: 4
:jenkins_url: https://jenkins.askerc.com
:jenkins_job: Github/job/backupScript
:git_branch: feature%252Fjenkins

image::{jenkins_url}/job/{jenkins_job}/job/{git_branch}/lastBuild/badge/icon?subject=Build["Build status", link="{jenkins_url}/job/{jenkins_job}/job/{git_branch}/"]


== Info
This is python script used to backup folders to external hard drive.
It uses link:./rsync.md[rsync] command to check if files/folders need to be copied before the
actual copying.

[NOTE]
====
`rsync` command can also delete files!!!

You must set "no-delete" option in configuration file if you don't want to
delete files on backup disk/folder. See link:./exampleBackupConfig.py[config example].
====

Before actual copying/backup a *dry run* command is run which shows what a real command
is going to do.
Then you decide if you are going to execute *real run* command which will actually copy/backup
files.

The default link:./rsync.md[rsync] command used: `rsync -rltgoDvP --modify-window=1 --delete`.

For now only Linux systems are supported (don't know how it is on Windows and
link:./rsync.md[rsync] command).

WARNING: We are not responsible for any data loss.

=== Intentions
* replace manual copying of important/special files
* make copying more efficient (copy only those files which have changed).

link:./rsync.md[Here] you can check from some information about `rsync` command.


== Usage
* You must specify which folders/disks to backup. This information is stored in a
configuration file.

** Configuration file:
*** link:./exampleBackupConfig.py[example]
*** link:#configuration-file[detailed description]

** How to pass configuration file to the script:
*** create `backupConfig.py` file in the same directory as link:./backup.py[backup.py] script
this way you don't need to specify configuration file when you launch the script,
so script can be launched like this: `python backup.py`
*** pass configuration file as an argument when you launch the script:
**** `python backup.py -c myBackupConfig.py`
**** `python backup.py -c myBackupConfig`

* The script first runs a *dry run* which shows what a real command is going to do. This is used
because that way we can cancel if we see that something would go wrong. So first a *dry run*
command is run and than you get prompted if a real command should be run.
image:./Res/demo.gif[demo]

=== Script parameters

[source]
----
python backup.py [OPTION]

Options:
  -h, --help        show this help

  -a, --all         backup all specified folders (don't ask which folders to backup)

  -c, --config      specify file which stores information about which folders to backup
                    if this is not specified the script looks for backupConfig.py
                    example: python backup.py -c myBackupConfig.py
                             python backup.py -c myBackupConfig

  -n, --no-confirm  No need to confirm rsync command execution
                    CAUTION: This option causes that all rsync commands are executed
                             without any user interaction. Note that rsync command
                             can delete files (set "no-delete" option in config file
                             if you don't want to delete files on backup disk/folder)
----


== Configuration file [[configuration-file,Configuration file]]
* link:./exampleBackupConfig.py[Example]

=== Special "folders" options:
* `exclude`: specify which files/folders/patterns to *not* include in the backup
* `options`: specify special options for `rsync` command
** `no-delete`: keep files/folders which don't exist on source path but exist on destination path
(this is useful for folders like Pictures...)


== Development

Before each commit:

* check source code for best coding standards: `make check`
* run simple test: `make test`

Or you can just run `make commit` which will run all the necessary commands before running
`git commit`. Note that you still need to add files to index (`git add`).

WARNING: If there are some errors fix them before committing!

=== Dependencies
* https://www.gnu.org/software/make/[GNU - make]
* `pip` link:requirements.dev.txt[requirements.dev.txt]


== Suggestions
If you have any suggestions please let me know (you can submit pull request, open a discussion or
open an issue).


== License
See the link:./LICENSE.md[LICENSE] file for license rights and limitations (MIT).


== TODO
* [ ] Add support for Windows

* [x] Fix `C901 'BackupClass.backup' is too complex (15)`
